<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Mejor control de zoom en m√≥viles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Control Restaurante Pro</title>
    <!-- XLSX desde CDN (sin integrity aqu√≠; a√±ade integrity si tienes el hash) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        :root {
            --primary-color: #8B0000; /* Rojo vino */
            --secondary-color: #000000; /* Negro */
            --accent-color: #D4AF37; /* Dorado */
            --light-color: #FFFFFF; /* Blanco */
            --success-color: #4CAF50; /* Verde para pagado */
            --danger-color: #F44336; /* Rojo para pendiente */
            --background-color: #F5F5F5;
            --text-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 80px; /* Espacio para la barra inferior */
        }

        .container {
            max-width: 100%;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-color);
            padding: 15px;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .section {
            background-color: var(--light-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.2rem;
        }

        .section-title i {
            margin-right: 10px;
            font-size: 1.4rem;
        }

        /* Vista de mesas */
        .mesas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .mesa {
            background-color: var(--light-color);
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mesa:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .mesa-pendiente {
            border-color: var(--danger-color);
        }

        .mesa-pagada {
            border-color: var(--success-color);
        }

        .mesa-numero {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .mesa-estado {
            font-size: 0.8rem;
            margin-bottom: 10px;
            padding: 3px 8px;
            border-radius: 15px;
            display: inline-block;
        }

        .estado-pendiente {
            background-color: var(--danger-color);
            color: white;
        }

        .estado-pagado {
            background-color: var(--success-color);
            color: white;
        }

        .btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #388E3C;
        }

        .btn-accent {
            background-color: var(--accent-color);
            color: var(--secondary-color);
        }

        .btn-accent:hover {
            background-color: #C19B2A;
        }

        /* Vista de pedido */
        .pedido-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .pedido-mesa {
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .productos-lista {
            margin-top: 20px;
        }

        .producto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .producto-info {
            flex: 1;
        }

        .producto-nombre {
            font-weight: 500;
        }

        .producto-detalles {
            font-size: 0.9rem;
            color: #666;
        }

        .producto-total {
            font-weight: bold;
            color: var(--primary-color);
        }

        .btn-eliminar {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
        }

        .totales {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .total-mesa, .total-general {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .total-general {
            font-size: 1.2rem;
            color: var(--primary-color);
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        /* Navegaci√≥n inferior */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--secondary-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light-color);
            text-decoration: none;
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            background-color: var(--primary-color);
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        /* Modo oscuro: redefinir variables para consistencia */
        body.dark-mode {
            --primary-color: #bb86fc;
            --secondary-color: #121212;
            --accent-color: #03dac6;
            --light-color: #1E1E1E;
            --text-color: #E0E0E0;
            --background-color: #121212;
            --success-color: #2e7d32;
            --danger-color: #cf6679;
        }

        .dark-mode .section {
            background-color: var(--light-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .dark-mode .form-control {
            background-color: #2D2D2D;
            color: var(--text-color);
            border-color: #444;
        }

        .dark-mode .totales {
            background-color: #2D2D2D;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .container {
                max-width: 750px;
                margin: 0 auto;
            }
            
            .mesas-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üçΩÔ∏è Control Restaurante Pro</h1>
        <p class="subtitle">Gesti√≥n de mesas, pedidos y contabilidad diaria</p>
    </header>

    <div class="container">
        <!-- Vista de Mesas -->
        <div id="vista-mesas" class="section">
            <div class="section-title">
                <i>üìã</i> Control de Mesas
            </div>
            <div class="mesas-grid" id="mesas-container">
                <!-- Las mesas se generar√°n din√°micamente aqu√≠ -->
            </div>
        </div>

        <!-- Vista de Pedido -->
        <div id="vista-pedido" class="section" style="display: none;">
            <div class="pedido-header">
                <div class="pedido-mesa" id="pedido-mesa-titulo">Mesa 1</div>
                <button class="btn btn-accent" id="btn-volver-mesas">‚Üê Volver</button>
            </div>
            
            <div class="form-group">
                <label for="producto-nombre">Producto</label>
                <input type="text" id="producto-nombre" class="form-control" placeholder="Nombre del producto">
            </div>
            
            <div class="form-group">
                <label for="producto-cantidad">Cantidad</label>
                <input type="number" id="producto-cantidad" class="form-control" value="1" min="1">
            </div>
            
            <div class="form-group">
                <label for="producto-precio">Precio unitario</label>
                <input type="number" id="producto-precio" class="form-control" step="0.01" placeholder="0.00">
            </div>
            
            <button class="btn" id="btn-agregar-producto">‚ûï Agregar producto</button>
            
            <div class="productos-lista" id="productos-lista">
                <!-- Los productos se agregar√°n din√°micamente aqu√≠ -->
            </div>
            
            <div class="totales">
                <div class="total-mesa">
                    <span>Total de la mesa:</span>
                    <span id="total-mesa">$0.00</span>
                </div>
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn" id="btn-guardar-pedido">üíæ Guardar pedido</button>
                <button class="btn btn-success" id="btn-marcar-pagado">üí∞ Marcar como pagado</button>
            </div>
        </div>

        <!-- Vista de Reportes -->
        <div id="vista-reportes" class="section" style="display: none;">
            <div class="section-title">
                <i>üìä</i> Reportes y Contabilidad
            </div>
            
            <div class="totales">
                <div class="total-general">
                    <span>Total general del d√≠a:</span>
                    <span id="total-general">$0.00</span>
                </div>
            </div>
            
            <button class="btn btn-accent" id="btn-generar-excel">üì¶ Generar reporte Excel</button>
            <button class="btn" id="btn-subir-drive" style="margin-top: 10px;">‚òÅÔ∏è Subir a Google Drive</button>
            
            <div style="margin-top: 20px;">
                <h3 style="margin-bottom: 10px;">Resumen por mesas</h3>
                <div id="resumen-mesas">
                    <!-- El resumen se generar√° din√°micamente aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>

    <!-- Navegaci√≥n inferior -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" data-view="mesas">
            <i>üìã</i>
            <span>Mesas</span>
        </a>
        <a href="#" class="nav-item" data-view="reportes">
            <i>üìä</i>
            <span>Reportes</span>
        </a>
        <a href="#" class="nav-item" id="toggle-dark-mode">
            <i>üåô</i>
            <span>Modo Oscuro</span>
        </a>
    </div>

    <script>
        // Datos de ejemplo y estado
        let mesas = [];
        const NUM_MESAS = 8;
        let mesaActual = null;

        // Inicializar la aplicaci√≥n
        function inicializarApp() {
            // Cargar datos del localStorage de forma segura
            const datosGuardados = localStorage.getItem('restauranteData');
            if (datosGuardados) {
                try {
                    const parsed = JSON.parse(datosGuardados);
                    if (Array.isArray(parsed)) {
                        mesas = parsed;
                    } else {
                        mesas = [];
                    }
                } catch (e) {
                    mesas = [];
                }
            }

            // Si no hay mesas, crear por defecto (estado 'pendiente' para indicar disponible)
            if (!mesas || mesas.length === 0) {
                for (let i = 1; i <= NUM_MESAS; i++) {
                    mesas.push({
                        numero: i,
                        estado: 'pendiente', // 'pendiente' o 'pagada'
                        productos: [],
                        total: 0
                    });
                }
                guardarDatos();
            }
            
            // Renderizar mesas y totales
            renderizarMesas();
            actualizarTotales();
            
            // Configurar eventos
            configurarEventos();
        }

        // Guardar datos en localStorage
        function guardarDatos() {
            try {
                localStorage.setItem('restauranteData', JSON.stringify(mesas));
            } catch (e) {
                console.error('Error al guardar en localStorage', e);
            }
        }

        // Renderizar la vista de mesas
        function renderizarMesas() {
            const container = document.getElementById('mesas-container');
            container.innerHTML = '';
            
            mesas.forEach(mesa => {
                const mesaElement = document.createElement('div');
                mesaElement.className = `mesa ${mesa.estado === 'pendiente' ? 'mesa-pendiente' : 'mesa-pagada'}`;
                mesaElement.innerHTML = `
                    <div class="mesa-numero">Mesa ${mesa.numero}</div>
                    <div class="mesa-estado ${mesa.estado === 'pendiente' ? 'estado-pendiente' : 'estado-pagado'}">
                        ${mesa.estado === 'pendiente' ? 'Pendiente' : 'Pagada'}
                    </div>
                    <button class="btn abrir-pedido" data-mesa="${mesa.numero}">üìã Abrir pedido</button>
                `;
                container.appendChild(mesaElement);
            });
        }

        // Renderizar productos de una mesa
        function renderizarProductos(mesa) {
            const container = document.getElementById('productos-lista');
            container.innerHTML = '';
            
            if (!mesa || mesa.productos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No hay productos agregados</p>';
                document.getElementById('total-mesa').textContent = `$${(mesa && mesa.total ? mesa.total.toFixed(2) : '0.00')}`;
                return;
            }
            
            mesa.productos.forEach((producto, index) => {
                const productoElement = document.createElement('div');
                productoElement.className = 'producto-item';
                productoElement.innerHTML = `
                    <div class="producto-info">
                        <div class="producto-nombre">${escapeHtml(producto.nombre)}</div>
                        <div class="producto-detalles">${producto.cantidad} x $${producto.precio.toFixed(2)}</div>
                    </div>
                    <div class="producto-total">$${(producto.cantidad * producto.precio).toFixed(2)}</div>
                    <button class="btn-eliminar" data-index="${index}" title="Eliminar producto">üóëÔ∏è</button>
                `;
                container.appendChild(productoElement);
            });
            
            // Actualizar total de la mesa
            document.getElementById('total-mesa').textContent = `$${mesa.total.toFixed(2)}`;
        }

        // Escapar HTML para evitar inyecci√≥n simple en nombres
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // Configurar eventos
        function configurarEventos() {
            // Navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const view = this.getAttribute('data-view');
                    
                    // Actualizar navegaci√≥n activa
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    // Si el item tiene data-view, activarlo
                    if (view) this.classList.add('active');
                    
                    // Mostrar vista correspondiente
                    document.getElementById('vista-mesas').style.display = 'none';
                    document.getElementById('vista-pedido').style.display = 'none';
                    document.getElementById('vista-reportes').style.display = 'none';
                    
                    if (view === 'mesas') {
                        document.getElementById('vista-mesas').style.display = 'block';
                    } else if (view === 'reportes') {
                        document.getElementById('vista-reportes').style.display = 'block';
                        actualizarReportes();
                    }
                });
            });
            
            // Abrir pedido de mesa (delegaci√≥n)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('abrir-pedido')) {
                    const mesaNum = parseInt(e.target.getAttribute('data-mesa'));
                    abrirPedidoMesa(mesaNum);
                }
            });
            
            // Volver a mesas desde pedido
            document.getElementById('btn-volver-mesas').addEventListener('click', function() {
                // Mostrar vista mesas
                document.getElementById('vista-pedido').style.display = 'none';
                document.getElementById('vista-mesas').style.display = 'block';
                // Actualizar navegaci√≥n
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelector('.nav-item[data-view="mesas"]').classList.add('active');
            });
            
            // Agregar producto
            document.getElementById('btn-agregar-producto').addEventListener('click', agregarProducto);
            
            // Eliminar producto (delegaci√≥n)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-eliminar')) {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    eliminarProducto(index);
                }
            });
            
            // Guardar pedido
            document.getElementById('btn-guardar-pedido').addEventListener('click', guardarPedido);
            
            // Marcar como pagado
            document.getElementById('btn-marcar-pagado').addEventListener('click', marcarComoPagado);
            
            // Generar Excel
            document.getElementById('btn-generar-excel').addEventListener('click', generarExcel);
            
            // Subir a Google Drive
            document.getElementById('btn-subir-drive').addEventListener('click', subirADrive);
            
            // Modo oscuro
            document.getElementById('toggle-dark-mode').addEventListener('click', function(e) {
                e.preventDefault();
                document.body.classList.toggle('dark-mode');
                this.querySelector('span').textContent = document.body.classList.contains('dark-mode') ? 'Modo Claro' : 'Modo Oscuro';
            });
        }

        // Abrir pedido de una mesa
        function abrirPedidoMesa(numero) {
            mesaActual = mesas.find(m => m.numero === numero);
            if (!mesaActual) {
                mostrarToast('Mesa no encontrada', 'error');
                return;
            }
            document.getElementById('pedido-mesa-titulo').textContent = `Mesa ${mesaActual.numero}`;
            renderizarProductos(mesaActual);
            
            // Cambiar a vista de pedido
            document.getElementById('vista-mesas').style.display = 'none';
            document.getElementById('vista-pedido').style.display = 'block';
            
            // Actualizar navegaci√≥n activa
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        }

        // Agregar producto a la mesa actual
        function agregarProducto() {
            if (!mesaActual) {
                mostrarToast('Abra una mesa antes de agregar productos', 'error');
                return;
            }

            const nombre = document.getElementById('producto-nombre').value.trim();
            const cantidad = parseInt(document.getElementById('producto-cantidad').value, 10) || 0;
            const precio = parseFloat(document.getElementById('producto-precio').value);

            // Validaciones robustas
            if (!nombre || isNaN(cantidad) || cantidad <= 0 || isNaN(precio) || precio <= 0) {
                mostrarToast('Por favor, complete todos los campos correctamente', 'error');
                return;
            }
            
            mesaActual.productos.push({
                nombre,
                cantidad,
                precio
            });
            
            // Calcular total de la mesa y persistir
            calcularTotalMesa(mesaActual);
            guardarDatos();
            
            // Limpiar formulario
            document.getElementById('producto-nombre').value = '';
            document.getElementById('producto-cantidad').value = '1';
            document.getElementById('producto-precio').value = '';
            
            // Renderizar productos actualizados
            renderizarProductos(mesaActual);
            
            // Actualizar listas y totales
            renderizarMesas();
            actualizarTotales();
            
            mostrarToast('Producto agregado correctamente');
        }

        // Eliminar producto
        function eliminarProducto(index) {
            if (!mesaActual) {
                mostrarToast('Abra una mesa antes de eliminar productos', 'error');
                return;
            }
            if (!Number.isInteger(index) || index < 0 || index >= mesaActual.productos.length) {
                mostrarToast('√çndice de producto inv√°lido', 'error');
                return;
            }
            mesaActual.productos.splice(index, 1);
            calcularTotalMesa(mesaActual);
            guardarDatos();
            renderizarProductos(mesaActual);
            renderizarMesas();
            actualizarTotales();
            mostrarToast('Producto eliminado');
        }

        // Calcular total de una mesa
        function calcularTotalMesa(mesa) {
            mesa.total = mesa.productos.reduce((total, producto) => {
                const cantidad = Number.isFinite(producto.cantidad) ? producto.cantidad : 0;
                const precio = Number.isFinite(producto.precio) ? producto.precio : 0;
                return total + (cantidad * precio);
            }, 0);
        }

        // Guardar pedido
        function guardarPedido() {
            if (!mesaActual) {
                mostrarToast('Abra una mesa antes de guardar', 'error');
                return;
            }
            if (!mesaActual.productos || mesaActual.productos.length === 0) {
                mostrarToast('No hay productos para guardar', 'error');
                return;
            }
            
            mesaActual.estado = 'pendiente';
            calcularTotalMesa(mesaActual);
            guardarDatos();
            renderizarMesas();
            actualizarTotales();
            mostrarToast('Pedido guardado correctamente');
        }

        // Marcar como pagado
        function marcarComoPagado() {
            if (!mesaActual) {
                mostrarToast('Abra una mesa antes de marcar como pagado', 'error');
                return;
            }
            if (!mesaActual.productos || mesaActual.productos.length === 0) {
                mostrarToast('No hay productos para marcar como pagado', 'error');
                return;
            }
            
            mesaActual.estado = 'pagada';
            calcularTotalMesa(mesaActual);
            guardarDatos();
            renderizarMesas();
            actualizarTotales();
            mostrarToast('Mesa marcada como pagada');
            
            // Volver a la vista de mesas
            document.getElementById('vista-pedido').style.display = 'none';
            document.getElementById('vista-mesas').style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('.nav-item[data-view="mesas"]').classList.add('active');
        }

        // Actualizar totales generales
        function actualizarTotales() {
            const totalGeneral = mesas.reduce((total, mesa) => {
                return total + (mesa.total || 0);
            }, 0);
            
            const el = document.getElementById('total-general');
            if (el) el.textContent = `$${totalGeneral.toFixed(2)}`;
        }

        // Actualizar reportes
        function actualizarReportes() {
            // Asegurarse de que los totales est√©n actualizados
            mesas.forEach(m => calcularTotalMesa(m));
            actualizarTotales();
            
            // Actualizar resumen por mesas
            const resumenContainer = document.getElementById('resumen-mesas');
            resumenContainer.innerHTML = '';
            
            mesas.forEach(mesa => {
                const mesaElement = document.createElement('div');
                mesaElement.className = 'total-mesa';
                mesaElement.innerHTML = `
                    <span>Mesa ${mesa.numero} (${mesa.estado}):</span>
                    <span>$${(mesa.total || 0).toFixed(2)}</span>
                `;
                resumenContainer.appendChild(mesaElement);
            });
        }

        // Generar Excel
        function generarExcel() {
            // Comprobar que XLSX est√© cargado
            if (typeof XLSX === 'undefined') {
                mostrarToast('La librer√≠a XLSX no est√° disponible. Verifica la conexi√≥n al CDN.', 'error');
                return;
            }

            // Crear datos para el Excel
            const datos = [];
            const ahora = new Date();
            const fechaIso = ahora.toISOString().split('T')[0]; // YYYY-MM-DD
            
            mesas.forEach(mesa => {
                if (mesa.productos && mesa.productos.length > 0) {
                    mesa.productos.forEach(producto => {
                        datos.push({
                            'Mesa': mesa.numero,
                            'EstadoMesa': mesa.estado,
                            'Producto': producto.nombre,
                            'Cantidad': producto.cantidad,
                            'Precio Unitario': producto.precio,
                            'Total': producto.cantidad * producto.precio,
                            'Fecha': fechaIso
                        });
                    });
                }
            });
            
            if (datos.length === 0) {
                mostrarToast('No hay datos para exportar', 'error');
                return;
            }
            
            // Crear libro de trabajo y descargar
            try {
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(datos);
                XLSX.utils.book_append_sheet(wb, ws, 'Reporte Restaurante');
                XLSX.writeFile(wb, `Reporte_Restaurante_${fechaIso}.xlsx`);
                mostrarToast('Reporte Excel generado y descargado');
            } catch (e) {
                console.error('Error generando Excel', e);
                mostrarToast('Error al generar el Excel', 'error');
            }
        }

        // Subir a Google Drive (simulaci√≥n)
        function subirADrive() {
            // En una implementaci√≥n real, aqu√≠ se integrar√≠a con la API de Google Drive
            mostrarToast('Funcionalidad de Google Drive en desarrollo');
        }

        // Mostrar notificaci√≥n toast (mejor manejo para evitar solapamiento)
        let toastTimeout = null;
        function mostrarToast(mensaje, tipo = 'success') {
            const toast = document.getElementById('toast');
            // Reset visual y timeout anterior
            toast.classList.remove('show');
            if (toastTimeout) {
                clearTimeout(toastTimeout);
                toastTimeout = null;
            }

            toast.textContent = mensaje;
            toast.style.backgroundColor = (tipo === 'error') ? getComputedStyle(document.documentElement).getPropertyValue('--danger-color') || '#F44336' : getComputedStyle(document.documentElement).getPropertyValue('--primary-color') || '#8B0000';
            toast.classList.add('show');

            toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Inicializar la aplicaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', inicializarApp);
    </script>
</body>
</html>
